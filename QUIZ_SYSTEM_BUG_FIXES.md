# ุฅุตูุงุญ ูุดุงูู setState ูTimer - Course Detail Screen โ

## ูุธุฑุฉ ุนุงูุฉ
ุชู ุฅุตูุงุญ ุงููุดุงูู ุงููุชุนููุฉ ุจู `setState()` ู `Timer` ูู ุดุงุดุฉ ุชูุงุตูู ุงูุฏูุฑุฉุ ุฎุงุตุฉ ูู ูุธุงู ุงููููุฒุงุช ูุงูุนุฏุงุฏ ุงูุชูุงุฒูู.

## ๐ ุงููุดุงูู ุงูููุญุฏุฏุฉ ูุงูุญููู

### 1. **ูุดููุฉ Timer ูู ุงูุนุฏุงุฏ ุงูุชูุงุฒูู**

#### โ **ุงููุดููุฉ:**
```dart
Timer.periodic(const Duration(seconds: 1), (timer) {
  setState(() {
    countdown--;
  });
  // ุงูุชุงููุฑ ูุง ูุชู ุฅูุบุงุคู ุจุดูู ุตุญูุญ
});
```
- **ุงูุฎุทุฃ:** `setState()` called after dispose()
- **ุงูุณุจุจ:** ุงูุชุงููุฑ ูุณุชูุฑ ูู ุงูุนูู ุญุชู ุจุนุฏ ุฅุบูุงู ุงููุงูุฐุฉ

#### โ **ุงูุญู:**
```dart
final timer = Timer.periodic(const Duration(seconds: 1), (t) {
  if (countdown > 1) {
    if (context.mounted) {  // ูุญุต mounted ูุจู setState
      setState(() {
        countdown--;
      });
    } else {
      t.cancel();  // ุฅูุบุงุก ุงูุชุงููุฑ ุฅุฐุง ูุงู ุงูู context ูุญุฐูู
    }
  } else {
    t.cancel();
    if (context.mounted) {  // ูุญุต ูุจู ุงูุฅุบูุงู
      Navigator.of(context).pop();
    }
  }
});

// ุชูุธูู ุงูุชุงููุฑ ุนูุฏ ุฅุบูุงู ุงููุงูุฐุฉ
WidgetsBinding.instance.addPostFrameCallback((_) {
  if (!context.mounted) {
    timer.cancel();
  }
});
```

### 2. **ูุดููุฉ setState ูู ุฅุฌุงุจุฉ ุงููููุฒ**

#### โ **ุงููุดููุฉ:**
```dart
onTap: () {
  setState(() {
    selectedAnswer = index;
    showAnswer = true;
  });
  // ูุง ููุฌุฏ ูุญุต mounted
}
```

#### โ **ุงูุญู:**
```dart
onTap: showAnswer ? null : () {
  if (context.mounted) {  // ูุญุต mounted ูุจู setState
    setState(() {
      selectedAnswer = index;
      showAnswer = true;
    });
    _handleQuizAnswer(index, correctAnswer, quiz);
  }
},
```

### 3. **ูุดููุฉ Navigator.pop ุจุฏูู ูุญุต mounted**

#### โ **ุงููุดููุฉ:**
```dart
await Future.delayed(const Duration(milliseconds: 1500));
Navigator.of(context).pop();  // ูุง ููุฌุฏ ูุญุต mounted
```

#### โ **ุงูุญู:**
```dart
await Future.delayed(const Duration(milliseconds: 1500));
if (mounted && context.mounted) {
  Navigator.of(context).pop();
}
```

## ๐ง ุงูุชุญุณููุงุช ุงููุทุจูุฉ

### 1. **ุญูุงูุฉ Timer ูู Memory Leaks**
- ุฅุถุงูุฉ ูุญุต `context.mounted` ูุจู `setState`
- ุฅูุบุงุก ุงูุชุงููุฑ ุชููุงุฆูุงู ุนูุฏ ุฅุบูุงู ุงููุงูุฐุฉ
- ุงุณุชุฎุฏุงู `WidgetsBinding.instance.addPostFrameCallback` ููุชูุธูู

### 2. **ุญูุงูุฉ setState ูู StatefulBuilder**
- ูุญุต `context.mounted` ูุจู ูู ุงุณุชุฏุนุงุก ูู `setState`
- ููุน ุชูููุฐ ุงูุนูููุงุช ุนูู widgets ูุญุฐููุฉ

### 3. **ุญูุงูุฉ Navigation Operations**
- ูุญุต `mounted && context.mounted` ูุจู `Navigator.pop()`
- ุชุฌูุจ ุฃุฎุทุงุก ุงูู navigation ุนูู contexts ูุญุฐููุฉ

## ๐ฑ ุงูููุงุฆุฏ ุงูููุญููุฉ

### โ **ุงุณุชูุฑุงุฑ ุงูุชุทุจูู**
- ุนุฏู ุญุฏูุซ crashes ุจุณุจุจ `setState` ุจุนุฏ `dispose`
- ููุน memory leaks ูู ุงูุชุงููุฑุงุช
- ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุฃูุซุฑ ุณูุงุณุฉ

### ๐ **ุฃูุงู ุงูููุฏ**
- ูุญุต ุดุงูู ูุญุงูุฉ ุงูู widgets
- ููุน ุงูุนูููุงุช ุนูู objects ูุญุฐููุฉ
- ููุฏ ุฃูุซุฑ ููุงููุฉ ููุฃุฎุทุงุก

### โก **ุฃุฏุงุก ูุญุณู**
- ุนุฏู ุชุณุฑูุจ ุงูุฐุงูุฑุฉ ูู ุงูุชุงููุฑุงุช
- ุฅููุงู ุงูุนูููุงุช ุบูุฑ ุงูุถุฑูุฑูุฉ
- ุชูุธูู ุงูููุงุฑุฏ ุจุดูู ุตุญูุญ

## ๐ฏ ุฃูุงูู ุงูุชุทุจูู

### **ุงูููู ุงูููุญุฏุซ:**
`lib/features/courses/screens/course_detail_screen.dart`

### **ุงูุฏูุงู ุงูููุญุณูุฉ:**
1. `_showCountdown()` - ุงูุนุฏุงุฏ ุงูุชูุงุฒูู
2. `_handleQuizAnswer()` - ุงูุชุนุงูู ูุน ุฅุฌุงุจุฉ ุงููููุฒ
3. `_showQuizDialog()` - ูุงูุฐุฉ ุงููููุฒ (ุฎูุงุฑุงุช ุงูุฅุฌุงุจุฉ)

## ๐งช ุงุฎุชุจุงุฑ ุงูุฅุตูุงุญุงุช

### ููููุฉ ุงูุชุญูู ูู ูุฌุงุญ ุงูุฅุตูุงุญ:
1. **ุงุฎุชุจุงุฑ ุงููููุฒุงุช:**
   - ุฅููุงู ููุฏูู ูุฅุธูุงุฑ ูููุฒ
   - ุงุฎุชูุงุฑ ุฅุฌุงุจุฉ ูุงูุงูุชุธุงุฑ
   - ุงูุชุฃูุฏ ูู ุนุฏู ุธููุฑ ุฃุฎุทุงุก ูู ูุญุฏุฉ ุงูุชุญูู

2. **ุงุฎุชุจุงุฑ ุงูุนุฏุงุฏ ุงูุชูุงุฒูู:**
   - ุฅููุงู ููุฏูู ูุน ุฃูุซุฑ ูู ูููุฒ
   - ูุฑุงูุจุฉ ุงูุนุฏุงุฏ ุงูุชูุงุฒูู ุจูู ุงูุฃุณุฆูุฉ
   - ุงูุชุฃูุฏ ูู ุนุฏู ุธููุฑ ุฃุฎุทุงุก `setState` ูู Console

3. **ุงุฎุชุจุงุฑ ุฅุบูุงู ุณุฑูุน:**
   - ูุชุญ ูููุฒ ุซู ุฅุบูุงู ุงูุชุทุจูู ุณุฑูุนุงู
   - ุงูุชุฃูุฏ ูู ุนุฏู ุญุฏูุซ crashes

## ๐ ุฑุณุงุฆู ุงูุฎุทุฃ ุงูููุญูุฉ

### โ **ุงูุฃุฎุทุงุก ุงูุณุงุจูุฉ:**
```
FlutterError (setState() called after dispose()):
setState() called after the lifecycle state: defunct, not mounted
```

### โ **ุงููุชูุฌุฉ ุงูุญุงููุฉ:**
- ูุง ุชูุฌุฏ ุฃุฎุทุงุก `setState` ุจุนุฏ `dispose`
- ูุง ุชูุฌุฏ memory leaks ูู ุงูุชุงููุฑุงุช
- navigation ุขูู ููุญูู

## ๐ ุงูุชูุตูุงุช ูููุณุชูุจู

### 1. **ุงุณุชุฎุฏุงู ูุฐุง ุงูููุท ูู ูููุงุช ุฃุฎุฑู:**
```dart
// ุฏุงุฆูุงู ูุญุต mounted ูุจู setState
if (context.mounted) {
  setState(() {
    // ุงูุชุญุฏูุซุงุช ููุง
  });
}

// ุฏุงุฆูุงู ูุญุต mounted ูุจู Navigation
if (mounted && context.mounted) {
  Navigator.of(context).pop();
}

// ุฏุงุฆูุงู ุฅูุบุงุก ุงูุชุงููุฑุงุช
timer?.cancel();
```

### 2. **ุงุณุชุฎุฏุงู Completer ููุนูููุงุช async:**
```dart
final completer = Completer<void>();
// ุงุณุชุฎุฏุงู completer ูุถูุงู ุฅููุงุก ุงูุนูููุงุช ุจุดูู ุตุญูุญ
```

---

## โ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ

ุชู ุฅุตูุงุญ ุฌููุน ูุดุงูู `setState` ู `Timer` ูู ูุธุงู ุงููููุฒุงุช:
- **ูุง ุชูุฌุฏ crashes** ุจุณุจุจ `setState` ุจุนุฏ `dispose`
- **ูุง ุชูุฌุฏ memory leaks** ูู ุงูุชุงููุฑุงุช
- **ุชุฌุฑุจุฉ ูุณุชุฎุฏู ูุญุณูุฉ** ูุฃูุซุฑ ุงุณุชูุฑุงุฑุงู
- **ููุฏ ุขูู ูููุงูู ููุฃุฎุทุงุก**

๐ **ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู ุจุฏูู ูุดุงูู!** โจ

# APIs ููุฏูููุงุช ุงูุฏูุฑุงุช ุงููุณุชุฎุฏูุฉ ูู ุงููุธุงู

## ูุธุฑุฉ ุนุงูุฉ
ูุฐุง ููู ููุซู ุฌููุน APIs ุงููุณุชุฎุฏูุฉ ูุฌูุจ ูุฅุฏุงุฑุฉ ููุฏูููุงุช ุงูุฏูุฑุงุช ูู ูุณุงุฑ: ุงูุฃูุณุงู โ ุงูุฃุณุงุชุฐุฉ โ ุงูุฏูุฑุงุช โ ุงูููุฏูููุงุช

## ูุณุงุฑ ุงููุตูู ููููุฏูููุงุช
```
ุงูุฃูุณุงู (departments_screen.dart)
    โ
ุงูุฃุณุงุชุฐุฉ (instructors_screen.dart) 
    โ
ุฏูุฑุงุช ุงูุฃุณุชุงุฐ (instructor_courses_screen.dart)
    โ
ุชูุงุตูู ุงูุฏูุฑุฉ (course_detail_screen.dart)
    โ
ุงูููุฏูููุงุช
```

## APIs ุงููุณุชุฎุฏูุฉ

### 1. API ุฌูุจ ููุฏูููุงุช ุงูุฏูุฑุฉ ุงูุฑุฆูุณู
```
GET /api/courses/{courseId}/videos/previews
```

**ุงูุงุณุชุฎุฏุงู:**
- **ุงูููู**: `lib/features/courses/screens/course_detail_screen.dart`
- **ุงูุฏุงูุฉ**: `_loadVideos()`
- **ุงูุณุทุฑ**: 168

**ุงููุตู:**
- ูุฌูุจ ุฌููุน ููุฏูููุงุช ุงูุฏูุฑุฉ ูุน ูุนุงููุงุช
- ููุณุชุฎุฏู ุนูุฏูุง ูุง ุชูุฌุฏ ููุฏูููุงุช ูู ุงููุงุด
- ูุญูุธ ุงููุชูุฌุฉ ูู ุงููุงุด ูุงุณุชุฎุฏุงู ูุงุญู

**ูุซุงู ุงูููุฏ:**
```dart
final url = '${AppConstants.baseUrl}/api/courses/$courseId/videos/previews';
final headers = await ApiHeadersManager.instance.getAuthHeaders();
final response = await http.get(Uri.parse(url), headers: headers);
```

**ูููู ุงูุงุณุชุฌุงุจุฉ ุงููุชููุนุฉ:**
```json
// ุฅูุง List ูุจุงุดุฑุฉ
[
  {
    "id": "video_id",
    "title": "ุนููุงู ุงูููุฏูู",
    "link": "youtube_url",
    "is_free": false,
    "is_completed": false
  }
]

// ุฃู Map ุชุญุชูู ุนูู data
{
  "data": [
    {
      "id": "video_id", 
      "title": "ุนููุงู ุงูููุฏูู",
      // ...
    }
  ]
}
```

### 2. API ุชุจุฏูู ุญุงูุฉ ุฅููุงู ุงูููุฏูู
```
POST /api/videos/{videoId}/toggle
```

**ุงูุงุณุชุฎุฏุงู:**
- **ุงูููู**: `lib/features/courses/screens/course_detail_screen.dart`
- **ุงูุฏุงูุฉ**: `_toggleVideoCompletion()`
- **ุงูุณุทุฑ**: 433

**ุงููุตู:**
- ููุจุฏู ุญุงูุฉ ุฅููุงู ุงูููุฏูู (ููุชูู โ ุบูุฑ ููุชูู)
- ููุณุชุฎุฏู ุนูุฏ ุงูููุฑ ุนูู checkbox ุงูููุฏูู
- ูุญุฏุซ ุงููุงุด ุงููุญูู ุจุนุฏ ูุฌุงุญ ุงูุนูููุฉ

**ูุซุงู ุงูููุฏ:**
```dart
final String apiUrl = '${AppConstants.baseUrl}/api/videos/$videoId/toggle';
final headers = await ApiHeadersManager.instance.getAuthHeaders();
final response = await http.post(Uri.parse(apiUrl), headers: headers);
```

## ุฎุตุงุฆุต ุงููุธุงู

### 1. ุฅุฏุงุฑุฉ ุงููุงุด ุงูุฐููุฉ
- **ุงูุชุญูู ูู ุงููุงุด ุฃููุงู**: ูุจู ุงุณุชุฏุนุงุก API
- **ุญูุธ ูู ุงููุงุด**: ุจุนุฏ ูุฌุงุญ API
- **ุชุญุฏูุซ ุฅุฌุจุงุฑู**: ุฅููุงููุฉ ุชุฌุงูู ุงููุงุด

```dart
// ุงูุชุญูู ูู ุงููุงุด
List<dynamic>? cachedVideos = await CacheManager.instance.getVideos(courseId.toString());

// ุญูุธ ูู ุงููุงุด
await CacheManager.instance.setVideos(courseId.toString(), finalVideos);
```

### 2. ุฏุนู ุฏูุฑุงุช ุงูุทูุงุจ
- **ุงูุจูุงูุงุช ุงูููุฑููุฉ**: ุงุณุชุฎุฏุงู ููุฏูููุงุช ููุฑุณูุฉ ูุน ุจูุงูุงุช ุงูุฏูุฑุฉ
- **ุงูุชุญูู ุงูุฐูู**: ุงูุชุญูู ูู ุงููุงุด ุญุชู ููุฏูุฑุงุช ุงูููุฑููุฉ

```dart
if (isStudentCourse && widget.course['videos'] != null) {
  final courseVideos = widget.course['videos'] as List<dynamic>;
  // ุงุณุชุฎุฏุงู ุงูุจูุงูุงุช ุงููุฑููุฉ
}
```

### 3. ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก
- **ุงูุชูุงุก ุงูุฌูุณุฉ**: ูุดู ูุชูุฌูู ุชููุงุฆู ูุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู
- **ุฅุนุงุฏุฉ ุงููุญุงููุฉ**: ุฅููุงููุฉ ุฅุนุงุฏุฉ ุชุญููู ุงูููุฏูููุงุช
- **ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ**: ูููุณุชุฎุฏู ูุงููุทูุฑ

```dart
if (mounted && await TokenExpiredHandler.handleTokenExpiration(
  context,
  statusCode: response.statusCode,
  errorMessage: response.body,
)) {
  return; // ุชู ุงูุชุนุงูู ูุน ุงูุชูุงุก ุงูุชููู
}
```

## Headers ุงููุณุชุฎุฏูุฉ
ุฌููุน ุงูุทูุจุงุช ุชุณุชุฎุฏู Headers ููุฏุงุฑุฉ ูุฑูุฒูุงู:

```dart
final headers = await ApiHeadersManager.instance.getAuthHeaders();
```

**ุชุดูู ุนุงุฏุฉ:**
- `Authorization`: Bearer token
- `Content-Type`: application/json
- `Accept`: application/json

## ูุนุฑูุงุช ูููุฉ

### ูุนุฑู ุงูุฏูุฑุฉ
```dart
final courseId = widget.course['course_id'] ?? widget.course['id'];
```
- ููุณุชุฎุฏู `course_id` ุฃููุงูุ ุซู `id` ูุจุฏูู

### ูุนุฑู ุงูููุฏูู
```dart
final videoId = video['id'] ?? video['video_id'];
```
- ููุณุชุฎุฏู ูู API ุชุจุฏูู ุงูุฅููุงู

## ุฅุญุตุงุฆูุงุช ูุทุจุงุนุฉ ุชูุตูููุฉ

ุงููุธุงู ูุทุจุน ูุนูููุงุช ููุตูุฉ ูููุทูุฑูู:

```dart
print('๐ฅ ุฌุงุฑู ุชุญููู ููุฏูููุงุช ุงููุนุงููุฉ ูู API: $url');
print('๐ ุงุณุชุฌุงุจุฉ ุงูููุฏูููุงุช: ${response.statusCode}');
print('โ ุชู ุชุญููู ${finalVideos.length} ููุฏูู ูู API');
print('๐พ ุชู ุญูุธ ${finalVideos.length} ููุฏูู ูู ุงููุงุด');
```

## ุฃูุซูุฉ ุนูููุฉ

### 1. ุชุญููู ููุฏูููุงุช ุฏูุฑุฉ ูุนููุฉ
```
GET /api/courses/abc123/videos/previews
```

### 2. ุชุจุฏูู ุฅููุงู ููุฏูู ูุนูู  
```
POST /api/videos/video456/toggle
```

## ููุงุญุธุงุช ูููุฉ

1. **API ุงูููุฏูููุงุช ุงููุญูุฏ**: ููุฌุฏ API ูุงุญุฏ ููุท ูุฌูุจ ููุฏูููุงุช ุงูุฏูุฑุฉ
2. **ูุง ููุฌุฏ API ูููุตู ููููุฏูููุงุช ุงููุงููุฉ**: ุฌููุน ุงูููุฏูููุงุช ุชุฃุชู ูู `/previews`
3. **ุงูุชุญุฏูุซ ุงูุชููุงุฆู**: ุงููุงุด ููุญุฏุซ ุชููุงุฆูุงู ุนูุฏ ุชุบููุฑ ุญุงูุฉ ุงูุฅููุงู
4. **ุฏุนู ุงูุญุงูุงุช ุงููุฎุชููุฉ**: ุฏูุฑุงุช ุงูุทูุงุจ ูุงูุฏูุฑุงุช ุงูุนุงุฏูุฉ

## ุงูุชุงุฑูุฎ
- **ุชุงุฑูุฎ ุงูุชูุซูู**: 15 ุณุจุชูุจุฑ 2025
- **ุงูููู ุงููุฑุฌุนู**: `course_detail_screen.dart`
- **ุงููุทูุฑ**: ูุธุงู ุฅุฏุงุฑุฉ ุงูุชุนูู ุงูุฅููุชุฑููู
